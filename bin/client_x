#!/usr/bin/env python3

""" Stand alone client to integration test the psimbols server.

This client does not use any code from the main psimbols project.
Run it to exercise a running psimbols server. The server must have
been configured with the client id and AES key.

The default client is c256 which uses a 256-bit key.
"""

import argparse
import json
import logging
import requests
import sys

def read_config(filename):
    try:
        with open(filename, 'r') as f:
            config = json.load(f)
            if 'client' not in config:
                logging.error("Config file has no 'client' property")
            elif 'key' not in config:
                logging.error("Config file has no 'key' property")
            else:
                return config
    except IOError:
        logging.error('Could not read file')
    except json.JSONDecodeError:
        logging.error('Could not parse file as JSON')
    return {}

# parse the command-line
parser = argparse.ArgumentParser(description='client_x')
    
parser.add_argument('-c', '--config', 
    help='client configuration file (default %(default)s)',
    default='config/c256.json')
    
args = parser.parse_args()

# turn on logging
logging.basicConfig(
    format='%(asctime)s %(levelname)s %(message)s',
    level=logging.INFO)

logging.info('Reading client config from ' + args.config)
config = read_config(args.config)
if len(config) == 0:
    sys.exit(1)

logging.info('Using client ' + config['client'])
logging.info('With key ' + str(config['key']))
sys.exit(0)
response = requests.post('http://localhost:9393',
  data='{"client":"000","request":"12345678901234567890123456789012"}')
print(response)
